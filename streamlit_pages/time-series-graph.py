"""
ì‹œê³„ì—´ ì‹œê°í™” í˜ì´ì§€
"""
import streamlit as st

from backend.visualization_service import visualize_timeseries

# í˜ì´ì§€ ì œëª©
st.title("ğŸ“ˆ ì‹œê³„ì—´ ì‹œê°í™”")
st.markdown("ì„œìš¸ì‹œ ëŒ€ê¸°ì§ˆ ë°ì´í„°ì˜ ì‹œê³„ì—´ ì‹œê°í™”ë¥¼ ì œê³µí•©ë‹ˆë‹¤.")

# ë°ì´í„° ë° ì‹œê³„ì—´ ì •ë³´ í™•ì¸
if st.session_state.df is None:
    st.warning("ë°ì´í„°ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì‚¬ì´ë“œë°”ì—ì„œ ë°ì´í„°ë¥¼ ë¡œë“œí•´ì£¼ì„¸ìš”.")
elif st.session_state.series is None:
    st.warning("ì‹œê³„ì—´ ë°ì´í„°ê°€ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì‚¬ì´ë“œë°”ì—ì„œ ë¶„ì„ ë³€ìˆ˜ì™€ ì¸¡ì •ì†Œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.")
else:
    # ì‹œê³„ì—´ ë°ì´í„° ì •ë³´ í‘œì‹œ
    stat_col1, stat_col2, stat_col3 = st.columns(3)
    
    with stat_col1:
        st.metric(
            label="ë°ì´í„° ê¸¸ì´",
            value=f"{len(st.session_state.series):,}",
            help="ì‹œê³„ì—´ ë°ì´í„° í¬ì¸íŠ¸ ìˆ˜",
            border=True
        )
    
    with stat_col2:
        st.metric(
            label="ì‹œì‘ ë‚ ì§œ",
            value=f"{st.session_state.series.index.min().strftime('%Y-%m-%d %H:%M')}",
            help="ì²« ë²ˆì§¸ ë°ì´í„° ì‹œì ",
            border=True
        )
    
    with stat_col3:
        st.metric(
            label="ì¢…ë£Œ ë‚ ì§œ",
            value=f"{st.session_state.series.index.max().strftime('%Y-%m-%d %H:%M')}",
            help="ë§ˆì§€ë§‰ ë°ì´í„° ì‹œì ",
            border=True
        )
    
    # ì‹œê³„ì—´ ê¸°ë³¸ í†µê³„
    st.markdown("### ê¸°ë³¸ í†µê³„ëŸ‰")
    stats_df = st.session_state.series.describe().to_frame().T
    st.dataframe(stats_df, use_container_width=True)
    
    # ì‹œê³„ì—´ ê·¸ë˜í”„ í‘œì‹œ
    st.markdown("### ì‹œê³„ì—´ ê·¸ë˜í”„")
    
    fig = visualize_timeseries()
    if fig:
        st.plotly_chart(fig, use_container_width=True, theme="streamlit")
    else:
        st.error("ì‹œê³„ì—´ ê·¸ë˜í”„ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
    
    # ì¶”ê°€ ì„¤ëª… ë° ë„ì›€ë§
    with st.expander("ğŸ“Œ ì‹œê³„ì—´ ë¶„ì„ ë„ì›€ë§", expanded=False):
        st.markdown("""
        ### ğŸ“Š ì‹œê³„ì—´ ë°ì´í„° ë¶„ì„ì´ë€?
        
        ì‹œê³„ì—´ ë°ì´í„°ëŠ” ì‹œê°„ì— ë”°ë¼ ìˆœì°¨ì ìœ¼ë¡œ ê¸°ë¡ëœ ë°ì´í„°ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ë°ì´í„°ëŠ” ì¼ë°˜ì ì¸ ì •ì  ë°ì´í„°ì™€ ë‹¬ë¦¬ ì‹œê°„ì— ë”°ë¥¸ 
        íŒ¨í„´, ì¶”ì„¸, ê³„ì ˆì„±, ì£¼ê¸°ì„± ë“±ì˜ íŠ¹ì„±ì„ ê°€ì§‘ë‹ˆë‹¤.
        
        ### ğŸ“ˆ ì‹œê³„ì—´ ë°ì´í„°ì˜ ì£¼ìš” íŠ¹ì„±
        
        1. **ì¶”ì„¸(Trend)**: ì¥ê¸°ê°„ì— ê±¸ì¹œ ë°ì´í„°ì˜ ì „ë°˜ì ì¸ ìƒìŠ¹ ë˜ëŠ” í•˜ë½ íŒ¨í„´
        2. **ê³„ì ˆì„±(Seasonality)**: ì¼ì •í•œ ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ë°˜ë³µë˜ëŠ” íŒ¨í„´ (ì˜ˆ: 24ì‹œê°„ ì£¼ê¸°, 7ì¼ ì£¼ê¸°, 12ê°œì›” ì£¼ê¸° ë“±)
        3. **ì£¼ê¸°ì„±(Cyclicity)**: ë¹„ê³ ì •ì  ê¸°ê°„ ë™ì•ˆì˜ ìƒìŠ¹ê³¼ í•˜ë½ íŒ¨í„´ (ê²½ê¸° ìˆœí™˜ ë“±)
        4. **ë¶ˆê·œì¹™ì„±(Irregularity)**: ì˜ˆì¸¡í•  ìˆ˜ ì—†ëŠ” ë¬´ì‘ìœ„ ë³€ë™
        
        ### ğŸ” ë‹¤ìŒ ë‹¨ê³„ë¡œ ì‹œë„í•´ ë³¼ ìˆ˜ ìˆëŠ” ë¶„ì„
        
        - **ì‹œê³„ì—´ ë¶„í•´**: ë‹¤ìŒ í˜ì´ì§€ì—ì„œ ë°ì´í„°ë¥¼ ì¶”ì„¸, ê³„ì ˆì„±, ì”ì°¨ë¡œ ë¶„í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - **ì •ìƒì„± ê²€ì •**: ë°ì´í„°ê°€ ì‹œê°„ì— ê´€ê³„ì—†ì´ ì¼ì •í•œ í†µê³„ì  ì†ì„±ì„ ê°€ì§€ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        - **ëª¨ë¸ í•™ìŠµ**: ë¶„ì„í•œ íŠ¹ì„±ì„ ë°”íƒ•ìœ¼ë¡œ ì˜ˆì¸¡ ëª¨ë¸ì„ í•™ìŠµí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
        """)
